<html>
<head>
<style>
.block {
	width: 1em;
	height: 1em;
}

.blue {
	background-color: blue;
}

.destination {
	background-color: #FFDDDD;
}
</style>

<script src="jquery-1.7.1.js" type="text/javascript"></script>
<script>
var grid = [];
var walls = [];
grid_width = 40;
grid_height = 30;

for (var i=0; i<grid_height; i++) {
	var row = [];
	var wall_row = [];
	for (var j=0; j<grid_width; j++) {
		row.push(0);
		wall_row.push(0);
	}
	grid.push(row);
	walls.push(wall_row);
}

for (var i=0; i<25; i++) {
	walls[parseInt(Math.random()*grid_height)][parseInt(Math.random()*grid_width)] = 1;
}

for (var i=0; i<grid_width*grid_height*6; i++) {
	var x = Math.max(1,parseInt(Math.random()*(grid_width-1)));
	var y = Math.max(1,parseInt(Math.random()*(grid_height-1)));
	
	var adjacents = (walls[y-1][x] == 1) + (walls[y+1][x] == 1) + (walls[y][x-1] == 1) + (walls[y][x+1] == 1);
	var corner_adjacents = (walls[y-1][x-1] == 1) + (walls[y+1][x-1] == 1) + (walls[y-1][x-1] == 1) + (walls[y-1][x+1] == 1);
	
	switch (adjacents) {
	case 0:
		//grid[y][x] = Math.random() > 0.8;
		break;
	case 1:
		walls[y][x] = corner_adjacents < 2;
		break;
	case 2:
		//grid[y][x] = Math.random() > 0.9;
	case 3:
	case 4:
		//grid[y][x] = Math.random() > 0.999;
	}
}

for (var i=0; i<grid_height; i++) {
	for (var j=0; j<grid_width; j++) {
		if ( (j > grid_width/2 - 4) && (j < grid_width/2 + 4) && 
			 (i > grid_height/2 - 3) && (i < grid_height/2 + 3)) {
			walls[i][j] = 0;
		}
	}
}

jQuery(function() {
	for (var i=0; i<grid.length; i++) {
		for (var j=0; j<grid[i].length; j++) {
			var color = "";
			if (grid[i][j] == 1) {
				color = "blue";
			}
			if (grid[i][j] == 2) {
				color = "destination";
			}
			jQuery(document.body).append("<div id='"+i+"_"+j+"' class='block "+color+"' style='position: absolute; left:"+j+"em; top:"+i+"em;'/>");
		}
	}
	
	var toReveal = [];
	
	for (var i=0; i<grid_height; i++) {
		for (var j=0; j<grid_width; j++) {
			if (walls[i][j]) {
				toReveal.push([i,j]);
			}
		}
	}
	
	for (var i=0; i<toReveal.length*100; i++) {
		var rand1 = parseInt(Math.random()*toReveal.length);
		var rand2 = parseInt(Math.random()*toReveal.length);
		var temp = toReveal[rand1];
		toReveal[rand1] = toReveal[rand2];
		toReveal[rand2] = temp;
	}
	
	var i=0;
	
	var interval = setInterval(function(){
		var next = toReveal[i++];
		grid[next[0],next[1]] = 1;
		jQuery("#"+next[0]+"_"+next[1]+"").addClass("blue");
		if(i == toReveal.length) {
			clearInterval(interval);
		}
	}, 10);
});

</script>
</head>
<body>
</body>
</html>